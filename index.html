<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>æ¸¸æ³³æ•™ç·´é˜¿ä»ï½œé ç´„ç³»çµ±</title>
<style>
  :root{
    --sky:#4fb4e8;         /* å¤©ç©ºè—åŸºè‰² */
    --sky-100:#e6f4f9;     /* èƒŒæ™¯æ·¡è— */
    --sky-200:#bfe6f6;     /* è¡¨é ­æ·¡è— */
    --ink:#1f2937;         /* æ–‡å­—ä¸»è‰² */
    --muted:#64748b;       /* æ¬¡è¦æ–‡å­— */
    --bd:#dbe6ef;          /* é‚Šæ¡†è‰² */
    --panel:#ffffff;       /* å¡ç‰‡èƒŒæ™¯ */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family: system-ui, -apple-system, "Segoe UI", Roboto, Noto Sans, Arial; background:var(--sky-100); color:var(--ink)}
  header{background:linear-gradient(180deg,var(--sky),#68c5f0);color:#fff;padding:16px 12px;text-align:center;font-weight:700;letter-spacing:.5px}
  .container{max-width:1100px;margin:20px auto;padding:0 12px;display:grid;grid-template-columns: 320px 1fr;gap:16px}
  .card{background:var(--panel);border:1px solid var(--bd);border-radius:16px;box-shadow:0 10px 24px rgba(2,6,23,.06)}
  .coach{padding:16px;text-align:center}
  .coach img{width:100%;max-width:260px;border-radius:16px;border:1px solid var(--bd)}
  .coach h2{margin:12px 0 4px}
  .coach p{margin:0;color:var(--muted)}

  /* Calendar */
  .calendar{padding:16px;display:grid;gap:12px}
  .cal-head{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .cal-head .title{font-weight:800}
  .cal-head select{padding:8px 10px;border:1px solid var(--bd);border-radius:10px;background:#fff}
  .cal-head button{border:0;background:var(--sky);color:#fff;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
  .cal-head button:disabled{opacity:.5;cursor:not-allowed}

  table{width:100%;border-collapse:separate;border-spacing:6px}
  th{background:var(--sky-200);color:#06364b;padding:8px;border-radius:10px;font-weight:700}
  td{background:#fff;border:1px solid var(--bd);border-radius:10px;height:70px;text-align:right;vertical-align:top;padding:8px;cursor:pointer;position:relative}
  td.empty{background:transparent;border:1px dashed #cfe8f7;cursor:default}
  td:hover{outline:2px solid #aee4fb}
  td.selected{outline:3px solid var(--sky)}
  td .num{font-weight:700}
  td .badge{position:absolute;left:8px;bottom:8px;font-size:11px;color:#0b5b79;background:#e6f6ff;border:1px solid #bfe9ff;border-radius:999px;padding:2px 6px}

  /* Slots */
  .slots{padding:16px;display:grid;gap:10px}
  .slots h3{margin:0}
  .slot-list{display:flex;flex-wrap:wrap;gap:8px}
  .slot{background:var(--sky);color:#fff;border:0;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
  .slot[disabled]{background:#cfd8df;color:#6b7c8f;cursor:not-allowed}
  .note{color:var(--muted);font-size:13px}

  @media (max-width: 920px){
    .container{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <header>ğŸŠâ€â™‚ï¸ æ¸¸æ³³æ•™ç·´é˜¿ä»ï½œé ç´„ç³»çµ±ï¼ˆå¯åˆ‡æ›è‡³ 2050 å¹´ï¼‰</header>
  <div class="container">
    <!-- å·¦å´ï¼šæ•™ç·´å¡ç‰‡ + ç•¶æ—¥æ™‚æ®µ -->
    <aside class="card">
      <div class="coach">
        <img src="image.png" alt="æ¸¸æ³³æ•™ç·´é˜¿ä»">
        <h2>é˜¿ä»</h2>
        <p>å°ˆæ¥­æ¸¸æ³³æ•™ç·´ï½œæˆäººï¼å…’ç«¥ï½œåŸºç¤åˆ°å§¿å‹¢èª¿æ•´</p>
      </div>
      <div class="slots">
        <h3 id="slotTitle">è«‹å…ˆåœ¨å³æ–¹è¡Œäº‹æ›†é¸æ“‡æ—¥æœŸ</h3>
        <div class="slot-list" id="slotList"></div>
        <div class="note">ï¼Šæ™‚æ®µä»¥ 1 å°æ™‚ç‚ºå–®ä½ï¼›æ­¤ç‚ºå‰ç«¯ç¤ºç¯„ï¼Œç„¡é€£ç·šå¾Œç«¯ã€‚</div>
      </div>
    </aside>

    <!-- å³å´ï¼šè¡Œäº‹æ›† -->
    <section class="card calendar">
      <div class="cal-head">
        <button id="prevBtn">â—€ ä¸Šä¸€æœˆ</button>
        <div class="title" id="calTitle" aria-live="polite"></div>
        <button id="nextBtn">ä¸‹ä¸€æœˆ â–¶</button>
        <span style="flex:1"></span>
        <label>æœˆä»½
          <select id="monthSel" aria-label="é¸æ“‡æœˆä»½">
            <option value="0">1</option><option value="1">2</option><option value="2">3</option><option value="3">4</option>
            <option value="4">5</option><option value="5">6</option><option value="6">7</option><option value="7">8</option>
            <option value="8">9</option><option value="9">10</option><option value="10">11</option><option value="11">12</option>
          </select>
        </label>
        <label>å¹´ä»½
          <select id="yearSel" aria-label="é¸æ“‡å¹´ä»½"></select>
        </label>
      </div>
      <table id="calTable" aria-label="è¡Œäº‹æ›†">
        <thead>
          <tr>
            <th>æ—¥</th><th>ä¸€</th><th>äºŒ</th><th>ä¸‰</th><th>å››</th><th>äº”</th><th>å…­</th>
          </tr>
        </thead>
        <tbody id="calBody"></tbody>
      </table>
    </section>
  </div>

<script>
(() => {
  // ====== å¯èª¿æ•´ç¯„åœ ======
  const MIN_YEAR = 2000;
  const MAX_YEAR = 2050; // è‡³å°‘å¯é¸åˆ° 2050

  // ====== ç‹€æ…‹ ======
  const today = new Date();
  let curYear = today.getFullYear();
  let curMonth = today.getMonth(); // 0-11
  let selectedDateISO = null; // YYYY-MM-DD

  // ====== DOM ======
  const calTitle = document.getElementById('calTitle');
  const calBody = document.getElementById('calBody');
  const monthSel = document.getElementById('monthSel');
  const yearSel = document.getElementById('yearSel');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const slotTitle = document.getElementById('slotTitle');
  const slotList = document.getElementById('slotList');

  // ====== åˆå§‹åŒ–å¹´ä»½ä¸‹æ‹‰ ======
  function buildYearOptions(){
    yearSel.innerHTML = '';
    for(let y=MIN_YEAR; y<=MAX_YEAR; y++){
      const opt = document.createElement('option');
      opt.value = y; opt.textContent = y;
      yearSel.appendChild(opt);
    }
  }

  // ====== æ¸²æŸ“è¡Œäº‹æ›† ======
  function renderCalendar(){
    // æ›´æ–°æ¨™é¡Œ / ä¸‹æ‹‰ 
    calTitle.textContent = `${curYear} å¹´ ${curMonth+1} æœˆ`;
    monthSel.value = String(curMonth);
    yearSel.value = String(curYear);

    // æ§åˆ¶é‚Šç•ŒæŒ‰éˆ•
    const atMin = (curYear === MIN_YEAR && curMonth === 0);
    const atMax = (curYear === MAX_YEAR && curMonth === 11);
    prevBtn.disabled = atMin; nextBtn.disabled = atMax;

    // ç”Ÿæˆæ—¥æœŸ
    calBody.innerHTML = '';
    const first = new Date(curYear, curMonth, 1);
    const last = new Date(curYear, curMonth+1, 0);
    const startWeekday = first.getDay(); // 0(æ—¥)-6(å…­)
    const days = last.getDate();

    let row = document.createElement('tr');
    // å‰ç½®ç©ºç™½
    for(let i=0;i<startWeekday;i++){
      const td = document.createElement('td'); td.className = 'empty'; row.appendChild(td);
    }
    for(let d=1; d<=days; d++){
      if((startWeekday + d - 1) % 7 === 0 && row.children.length){
        calBody.appendChild(row); row = document.createElement('tr');
      }
      const td = document.createElement('td');
      const iso = toISO(curYear, curMonth+1, d);
      td.dataset.date = iso;
      td.innerHTML = `<span class="num">${d}</span>`;

      // å°å¾½ç« ï¼šå¯é ç´„æ™‚æ®µæ•¸ï¼ˆæ ¹æ“šè¦å‰‡é ä¼°ï¼‰
      const slots = getSlotsForDate(iso);
      if(slots.length){
        const badge = document.createElement('span');
        badge.className = 'badge';
        badge.textContent = `${slots.length} æª”`;
        td.appendChild(badge);
      }

      // ä»Šæ—¥é«˜äº®é‚Šæ¡†
      if(isToday(iso)) td.style.outline = '2px solid #9edcff';

      // é»æ“Šæ—¥æœŸ
      td.addEventListener('click', () => {
        document.querySelectorAll('td.selected').forEach(el=>el.classList.remove('selected'));
        if(!td.classList.contains('empty')){
          td.classList.add('selected');
          selectedDateISO = iso;
          renderSlots();
        }
      });
      row.appendChild(td);
    }
    // å¾Œç½®ç©ºç™½å¡«æ»¿åˆ—
    while(row.children.length < 7){
      const td = document.createElement('td'); td.className = 'empty'; row.appendChild(td);
    }
    calBody.appendChild(row);
  }

  // ====== ä¾æ—¥æœŸé¡¯ç¤ºæ™‚æ®µï¼ˆ1hr å–®ä½ï¼‰ ======
  // è¦å‰‡ç¤ºç¯„ï¼š
  //  é€±ä¸€~é€±äº”ï¼š09:00-12:00ã€14:00-18:00
  //  é€±å…­~é€±æ—¥ï¼š10:00-16:00ï¼ˆæ•´é»ï¼‰
  function getSlotsForDate(iso){
    const d = new Date(iso);
    const wd = d.getDay();
    const slots = [];
    if(wd === 0 || wd === 6){
      for(let h=10; h<=15; h++) slots.push(fmt(h));
    }else{
      for(let h=9; h<=11; h++) slots.push(fmt(h));
      for(let h=14; h<=17; h++) slots.push(fmt(h));
    }
    return slots;
  }

  function renderSlots(){
    if(!selectedDateISO){
      slotTitle.textContent = 'è«‹å…ˆåœ¨å³æ–¹è¡Œäº‹æ›†é¸æ“‡æ—¥æœŸ';
      slotList.innerHTML = '';
      return;
    }
    slotTitle.textContent = `${selectedDateISO} å¯é ç´„æ™‚æ®µ`;
    slotList.innerHTML = '';

    const slots = getSlotsForDate(selectedDateISO);
    if(!slots.length){
      const p = document.createElement('p');
      p.className='note'; p.textContent='æ­¤æ—¥ç„¡å¯é ç´„æ™‚æ®µ';
      slotList.appendChild(p);
      return;
    }

    // å¾ LocalStorage è®€å·²é ç´„ï¼ˆç¤ºç¯„ç”¨é€”ï¼‰
    const bookedKey = `booked:${selectedDateISO}`;
    const booked = JSON.parse(localStorage.getItem(bookedKey) || '[]');

    slots.forEach(t => {
      const btn = document.createElement('button');
      btn.className = 'slot';
      btn.textContent = t;
      if(booked.includes(t)){
        btn.setAttribute('disabled','true');
        btn.title = 'å·²é ç´„';
      }
      btn.addEventListener('click', () => {
        if(confirm(`ç¢ºèªé ç´„ é˜¿ä»ï½œ${selectedDateISO} ${t}ï¼Ÿï¼ˆ1å°æ™‚ï¼‰`)){
          booked.push(t);
          localStorage.setItem(bookedKey, JSON.stringify(booked));
          renderSlots();
          alert('é ç´„æˆåŠŸï¼');
          // åŒæ­¥æ›´æ–°è¡Œäº‹æ›†å¾½ç« æ•¸
          renderCalendar();
        }
      });
      slotList.appendChild(btn);
    });
  }

  // ====== å·¥å…· ======
  function toISO(y,m,d){
    return `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
  }
  function fmt(h){ return `${String(h).padStart(2,'0')}:00`; }
  function isToday(iso){
    const t = toISO(today.getFullYear(), today.getMonth()+1, today.getDate());
    return iso === t;
  }

  // ====== äº‹ä»¶ ======
  prevBtn.addEventListener('click', () => {
    if(curYear === MIN_YEAR && curMonth === 0) return;
    if(curMonth === 0){ curMonth = 11; curYear--; } else { curMonth--; }
    renderCalendar();
  });
  nextBtn.addEventListener('click', () => {
    if(curYear === MAX_YEAR && curMonth === 11) return;
    if(curMonth === 11){ curMonth = 0; curYear++; } else { curMonth++; }
    renderCalendar();
  });
  monthSel.addEventListener('change', () => { curMonth = Number(monthSel.value); renderCalendar(); });
  yearSel.addEventListener('change', () => { curYear = Number(yearSel.value); renderCalendar(); });

  // ====== å•Ÿå‹• ======
  buildYearOptions();
  renderCalendar();
})();
</script>
</body>
</html>
