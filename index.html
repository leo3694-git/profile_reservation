<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>游泳教練阿仁｜預約系統</title>
<style>
  :root{
    --sky:#4fb4e8;         /* 天空藍基色 */
    --sky-100:#e6f4f9;     /* 背景淡藍 */
    --sky-200:#bfe6f6;     /* 表頭淡藍 */
    --ink:#1f2937;         /* 文字主色 */
    --muted:#64748b;       /* 次要文字 */
    --bd:#dbe6ef;          /* 邊框色 */
    --panel:#ffffff;       /* 卡片背景 */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family: system-ui, -apple-system, "Segoe UI", Roboto, Noto Sans, Arial; background:var(--sky-100); color:var(--ink)}
  header{background:linear-gradient(180deg,var(--sky),#68c5f0);color:#fff;padding:16px 12px;text-align:center;font-weight:700;letter-spacing:.5px}
  .container{max-width:1100px;margin:20px auto;padding:0 12px;display:grid;grid-template-columns: 320px 1fr;gap:16px}
  .card{background:var(--panel);border:1px solid var(--bd);border-radius:16px;box-shadow:0 10px 24px rgba(2,6,23,.06)}
  .coach{padding:16px;text-align:center}
  .coach img{width:100%;max-width:260px;border-radius:16px;border:1px solid var(--bd)}
  .coach h2{margin:12px 0 4px}
  .coach p{margin:0;color:var(--muted)}

  /* Calendar */
  .calendar{padding:16px;display:grid;gap:12px}
  .cal-head{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .cal-head .title{font-weight:800}
  .cal-head select{padding:8px 10px;border:1px solid var(--bd);border-radius:10px;background:#fff}
  .cal-head button{border:0;background:var(--sky);color:#fff;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
  .cal-head button:disabled{opacity:.5;cursor:not-allowed}

  table{width:100%;border-collapse:separate;border-spacing:6px}
  th{background:var(--sky-200);color:#06364b;padding:8px;border-radius:10px;font-weight:700}
  td{background:#fff;border:1px solid var(--bd);border-radius:10px;height:70px;text-align:right;vertical-align:top;padding:8px;cursor:pointer;position:relative}
  td.empty{background:transparent;border:1px dashed #cfe8f7;cursor:default}
  td:hover{outline:2px solid #aee4fb}
  td.selected{outline:3px solid var(--sky)}
  td .num{font-weight:700}
  td .badge{position:absolute;left:8px;bottom:8px;font-size:11px;color:#0b5b79;background:#e6f6ff;border:1px solid #bfe9ff;border-radius:999px;padding:2px 6px}

  /* Slots */
  .slots{padding:16px;display:grid;gap:10px}
  .slots h3{margin:0}
  .slot-list{display:flex;flex-wrap:wrap;gap:8px}
  .slot{background:var(--sky);color:#fff;border:0;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
  .slot[disabled]{background:#cfd8df;color:#6b7c8f;cursor:not-allowed}
  .note{color:var(--muted);font-size:13px}

  @media (max-width: 920px){
    .container{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <header>🏊‍♂️ 游泳教練阿仁｜預約系統（可切換至 2050 年）</header>
  <div class="container">
    <!-- 左側：教練卡片 + 當日時段 -->
    <aside class="card">
      <div class="coach">
        <img src="image.png" alt="游泳教練阿仁">
        <h2>阿仁</h2>
        <p>專業游泳教練｜成人／兒童｜基礎到姿勢調整</p>
      </div>
      <div class="slots">
        <h3 id="slotTitle">請先在右方行事曆選擇日期</h3>
        <div class="slot-list" id="slotList"></div>
        <div class="note">＊時段以 1 小時為單位；此為前端示範，無連線後端。</div>
      </div>
    </aside>

    <!-- 右側：行事曆 -->
    <section class="card calendar">
      <div class="cal-head">
        <button id="prevBtn">◀ 上一月</button>
        <div class="title" id="calTitle" aria-live="polite"></div>
        <button id="nextBtn">下一月 ▶</button>
        <span style="flex:1"></span>
        <label>月份
          <select id="monthSel" aria-label="選擇月份">
            <option value="0">1</option><option value="1">2</option><option value="2">3</option><option value="3">4</option>
            <option value="4">5</option><option value="5">6</option><option value="6">7</option><option value="7">8</option>
            <option value="8">9</option><option value="9">10</option><option value="10">11</option><option value="11">12</option>
          </select>
        </label>
        <label>年份
          <select id="yearSel" aria-label="選擇年份"></select>
        </label>
      </div>
      <table id="calTable" aria-label="行事曆">
        <thead>
          <tr>
            <th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th>
          </tr>
        </thead>
        <tbody id="calBody"></tbody>
      </table>
    </section>
  </div>

<script>
(() => {
  // ====== 可調整範圍 ======
  const MIN_YEAR = 2000;
  const MAX_YEAR = 2050; // 至少可選到 2050

  // ====== 狀態 ======
  const today = new Date();
  let curYear = today.getFullYear();
  let curMonth = today.getMonth(); // 0-11
  let selectedDateISO = null; // YYYY-MM-DD

  // ====== DOM ======
  const calTitle = document.getElementById('calTitle');
  const calBody = document.getElementById('calBody');
  const monthSel = document.getElementById('monthSel');
  const yearSel = document.getElementById('yearSel');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const slotTitle = document.getElementById('slotTitle');
  const slotList = document.getElementById('slotList');

  // ====== 初始化年份下拉 ======
  function buildYearOptions(){
    yearSel.innerHTML = '';
    for(let y=MIN_YEAR; y<=MAX_YEAR; y++){
      const opt = document.createElement('option');
      opt.value = y; opt.textContent = y;
      yearSel.appendChild(opt);
    }
  }

  // ====== 渲染行事曆 ======
  function renderCalendar(){
    // 更新標題 / 下拉 
    calTitle.textContent = `${curYear} 年 ${curMonth+1} 月`;
    monthSel.value = String(curMonth);
    yearSel.value = String(curYear);

    // 控制邊界按鈕
    const atMin = (curYear === MIN_YEAR && curMonth === 0);
    const atMax = (curYear === MAX_YEAR && curMonth === 11);
    prevBtn.disabled = atMin; nextBtn.disabled = atMax;

    // 生成日期
    calBody.innerHTML = '';
    const first = new Date(curYear, curMonth, 1);
    const last = new Date(curYear, curMonth+1, 0);
    const startWeekday = first.getDay(); // 0(日)-6(六)
    const days = last.getDate();

    let row = document.createElement('tr');
    // 前置空白
    for(let i=0;i<startWeekday;i++){
      const td = document.createElement('td'); td.className = 'empty'; row.appendChild(td);
    }
    for(let d=1; d<=days; d++){
      if((startWeekday + d - 1) % 7 === 0 && row.children.length){
        calBody.appendChild(row); row = document.createElement('tr');
      }
      const td = document.createElement('td');
      const iso = toISO(curYear, curMonth+1, d);
      td.dataset.date = iso;
      td.innerHTML = `<span class="num">${d}</span>`;

      // 小徽章：可預約時段數（根據規則預估）
      const slots = getSlotsForDate(iso);
      if(slots.length){
        const badge = document.createElement('span');
        badge.className = 'badge';
        badge.textContent = `${slots.length} 檔`;
        td.appendChild(badge);
      }

      // 今日高亮邊框
      if(isToday(iso)) td.style.outline = '2px solid #9edcff';

      // 點擊日期
      td.addEventListener('click', () => {
        document.querySelectorAll('td.selected').forEach(el=>el.classList.remove('selected'));
        if(!td.classList.contains('empty')){
          td.classList.add('selected');
          selectedDateISO = iso;
          renderSlots();
        }
      });
      row.appendChild(td);
    }
    // 後置空白填滿列
    while(row.children.length < 7){
      const td = document.createElement('td'); td.className = 'empty'; row.appendChild(td);
    }
    calBody.appendChild(row);
  }

  // ====== 依日期顯示時段（1hr 單位） ======
  // 規則示範：
  //  週一~週五：09:00-12:00、14:00-18:00
  //  週六~週日：10:00-16:00（整點）
  function getSlotsForDate(iso){
    const d = new Date(iso);
    const wd = d.getDay();
    const slots = [];
    if(wd === 0 || wd === 6){
      for(let h=10; h<=15; h++) slots.push(fmt(h));
    }else{
      for(let h=9; h<=11; h++) slots.push(fmt(h));
      for(let h=14; h<=17; h++) slots.push(fmt(h));
    }
    return slots;
  }

  function renderSlots(){
    if(!selectedDateISO){
      slotTitle.textContent = '請先在右方行事曆選擇日期';
      slotList.innerHTML = '';
      return;
    }
    slotTitle.textContent = `${selectedDateISO} 可預約時段`;
    slotList.innerHTML = '';

    const slots = getSlotsForDate(selectedDateISO);
    if(!slots.length){
      const p = document.createElement('p');
      p.className='note'; p.textContent='此日無可預約時段';
      slotList.appendChild(p);
      return;
    }

    // 從 LocalStorage 讀已預約（示範用途）
    const bookedKey = `booked:${selectedDateISO}`;
    const booked = JSON.parse(localStorage.getItem(bookedKey) || '[]');

    slots.forEach(t => {
      const btn = document.createElement('button');
      btn.className = 'slot';
      btn.textContent = t;
      if(booked.includes(t)){
        btn.setAttribute('disabled','true');
        btn.title = '已預約';
      }
      btn.addEventListener('click', () => {
        if(confirm(`確認預約 阿仁｜${selectedDateISO} ${t}？（1小時）`)){
          booked.push(t);
          localStorage.setItem(bookedKey, JSON.stringify(booked));
          renderSlots();
          alert('預約成功！');
          // 同步更新行事曆徽章數
          renderCalendar();
        }
      });
      slotList.appendChild(btn);
    });
  }

  // ====== 工具 ======
  function toISO(y,m,d){
    return `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
  }
  function fmt(h){ return `${String(h).padStart(2,'0')}:00`; }
  function isToday(iso){
    const t = toISO(today.getFullYear(), today.getMonth()+1, today.getDate());
    return iso === t;
  }

  // ====== 事件 ======
  prevBtn.addEventListener('click', () => {
    if(curYear === MIN_YEAR && curMonth === 0) return;
    if(curMonth === 0){ curMonth = 11; curYear--; } else { curMonth--; }
    renderCalendar();
  });
  nextBtn.addEventListener('click', () => {
    if(curYear === MAX_YEAR && curMonth === 11) return;
    if(curMonth === 11){ curMonth = 0; curYear++; } else { curMonth++; }
    renderCalendar();
  });
  monthSel.addEventListener('change', () => { curMonth = Number(monthSel.value); renderCalendar(); });
  yearSel.addEventListener('change', () => { curYear = Number(yearSel.value); renderCalendar(); });

  // ====== 啟動 ======
  buildYearOptions();
  renderCalendar();
})();
</script>
</body>
</html>
